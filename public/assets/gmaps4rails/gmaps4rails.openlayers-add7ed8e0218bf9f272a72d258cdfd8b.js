((function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};this.Gmaps4RailsOpenlayers=function(){function a(){a.__super__.constructor.apply(this,arguments),this.map_options={},this.mergeWithDefault("map_options"),this.markers_conf={},this.mergeWithDefault("markers_conf"),this.openMarkers=null,this.markersLayer=null,this.markersControl=null}return b(a,Gmaps4Rails),a.prototype.createPoint=function(a,b){},a.prototype.createLatLng=function(a,b){return(new OpenLayers.LonLat(b,a)).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"))},a.prototype.createAnchor=function(a){return a===null?null:new OpenLayers.Pixel(a[0],a[1])},a.prototype.createSize=function(a,b){return new OpenLayers.Size(a,b)},a.prototype.createLatLngBounds=function(){return new OpenLayers.Bounds},a.prototype.createMap=function(){var a;return a=new OpenLayers.Map(this.map_options.id),a.addLayer(new OpenLayers.Layer.OSM),a.setCenter(this.createLatLng(this.map_options.center_latitude,this.map_options.center_longitude),this.map_options.zoom),a},a.prototype.createMarker=function(a){var b,c;return c=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),c.fillOpacity=1,this.markersLayer===null&&(this.markersLayer=new OpenLayers.Layer.Vector("Markers",null),this.map.addLayer(this.markersLayer),this.markersLayer.events.register("featureselected",this.markersLayer,this.onFeatureSelect),this.markersLayer.events.register("featureunselected",this.markersLayer,this.onFeatureUnselect),this.markersControl=new OpenLayers.Control.SelectFeature(this.markersLayer),this.map.addControl(this.markersControl),this.markersControl.activate()),a.marker_picture===""?(c.graphicHeight=30,c.externalGraphic="http://openlayers.org/dev/img/marker-blue.png"):(c.graphicWidth=a.marker_width,c.graphicHeight=a.marker_height,c.externalGraphic=a.marker_picture,a.marker_anchor!==null&&(c.graphicXOffset=a.marker_anchor[0],c.graphicYOffset=a.marker_anchor[1]),a.shadow_picture!==""&&(c.backgroundGraphic=a.shadow_picture,c.backgroundWidth=a.shadow_width,c.backgroundHeight=a.shadow_height,a.shadow_anchor!==null&&(c.backgroundXOffset=a.shadow_anchor[0],c.backgroundYOffset=a.shadow_anchor[1]))),c.graphicTitle=a.title,b=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a.Lng,a.Lat),null,c),b.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),this.markersLayer.addFeatures([b]),b},a.prototype.clearMarkers=function(){return this.clearMarkersLayerIfExists(),this.markersLayer=null,this.boundsObject=new OpenLayers.Bounds},a.prototype.clearMarkersLayerIfExists=function(){if(this.markersLayer!==null&&this.map.getLayer(this.markersLayer.id)!==null)return this.map.removeLayer(this.markersLayer)},a.prototype.extendBoundsWithMarkers=function(){var a,b,c,d,e;d=this.markers,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.boundsObject.extend(this.createLatLng(a.lat,a.lng)));return e},a.prototype.createClusterer=function(a){var b,c,d,e,f;return d={pointRadius:"${radius}",fillColor:"#ffcc66",fillOpacity:.8,strokeColor:"#cc6633",strokeWidth:"${width}",strokeOpacity:.8},c={context:{width:function(a){var b;return(b=a.cluster)!=null?b:{2:1}},radius:function(a){var b;return b=2,a.cluster&&(b=Math.min(a.attributes.count,7)+2),b}}},f=new OpenLayers.Style(d,c),e=new OpenLayers.Strategy.Cluster,b=new OpenLayers.Layer.Vector("Clusters",{strategies:[e],styleMap:new OpenLayers.StyleMap({"default":f,select:{fillColor:"#8aeeef",strokeColor:"#32a8a9"}})}),this.clearMarkersLayerIfExists(),this.map.addLayer(b),b.addFeatures(a),b},a.prototype.clusterize=function(){var a,b,c,d,e;if(this.markers_conf.do_clustering===!0){this.markerClusterer!==null&&this.clearClusterer(),b=new Array,e=this.markers;for(c=0,d=e.length;c<d;c++)a=e[c],b.push(a.serviceObject);return this.markerClusterer=this.createClusterer(b)}},a.prototype.clearClusterer=function(){return this.map.removeLayer(this.markerClusterer)},a.prototype.createInfoWindow=function(a){if(a.description!=null)return a.serviceObject.infoWindow=a.description},a.prototype.onPopupClose=function(a){return this.markersControl.unselect(this.feature)},a.prototype.onFeatureSelect=function(a){var b,c;return b=a.feature,c=new OpenLayers.Popup.FramedCloud("featurePopup",b.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(300,200),b.infoWindow,null,!0,this.onPopupClose),b.popup=c,c.feature=b,this.map.addPopup(c)},a.prototype.onFeatureUnselect=function(a){var b;b=a.feature;if(b.popup)return this.map.removePopup(b.popup),b.popup.destroy(),b.popup=null},a.prototype.fitBounds=function(){return this.map.zoomToExtent(this.boundsObject,!0)},a.prototype.centerMapOnUser=function(){return this.map.setCenter(this.userLocation)},a}()})).call(this)